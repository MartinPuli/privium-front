<div class="auth-page">
  <app-header [logged]="false"></app-header>

  <div class="auth-main">
    <!-- Loader inicial -->
    <div class="rp-loader" *ngIf="status === null">
      <div class="spinner"></div>
    </div>

    <!-- Resultado éxito / error -->
    <app-result-warn
      *ngIf="status === 1 || status === 0"
      [status]="status"
      [title]="rwTitle"
      [subtitle]="rwSubtitle"
      [description]="rwDescription"
      buttonLabel="Ir al inicio de sesión"
      (action)="onWarnAction()"
    ></app-result-warn>

    <!-- Formulario -->
    <app-auth-card
      *ngIf="status === 'form'"
      title="Restablecer contraseña"
      subtitle="Ingresa tu nueva contraseña dos veces para confirmarla."
      [buttons]="buttons"
      [links]="links"
      maxWidth="70%"
    >
      <form
        id="passwordForm"
        [formGroup]="passwordForm"
        (ngSubmit)="onSubmit()"
        class="rp-form"
        novalidate
      >
        <app-form-field
          label="Nueva contraseña"
          type="password"
          formControlName="password"
          [hasError]="
            passwordForm.get('password')!.invalid &&
            passwordForm.get('password')!.touched
          "
          [errorMessage]="
            passwordForm.get('password')!.hasError('required')
              ? 'La contraseña es requerida'
              : passwordForm.get('password')!.hasError('minlength')
              ? 'Mínimo 8 caracteres'
              : passwordForm.get('password')!.hasError('maxlength')
              ? 'Máximo 50 caracteres'
              : passwordForm.get('password')!.hasError('pattern')
              ? 'Debe incluir mayúscula, minúscula, número y símbolo'
              : ''
          "
          [showPasswordToggle]="true"
        ></app-form-field>

        <app-form-field
          label="Repetir contraseña"
          type="password"
          formControlName="confirmPassword"
          [hasError]="
            (passwordForm.hasError('mismatch') &&
              passwordForm.get('confirmPassword')!.touched) ||
            (passwordForm.get('confirmPassword')!.invalid &&
              passwordForm.get('confirmPassword')!.touched)
          "
          [errorMessage]="
            passwordForm.hasError('mismatch')
              ? 'Las contraseñas no coinciden'
              : passwordForm.get('confirmPassword')!.hasError('required')
              ? 'La confirmación es requerida'
              : passwordForm.get('confirmPassword')!.hasError('maxlength')
              ? 'Máximo 50 caracteres'
              : ''
          "
          [showPasswordToggle]="true"
        ></app-form-field>
      </form>
    </app-auth-card>
  </div>

  <app-footer [logged]="false"></app-footer>
</div>

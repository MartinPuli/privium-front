<div class="card-inner">
  <mat-checkbox
    class="inner-check"
    [checked]="selected"
    (change)="onCheckboxChange($event)"
  ></mat-checkbox>

  <!-- Mobile actions (<=768px): left vertical buttons -->
  <div class="mobile-actions" aria-hidden="false">
    <button mat-icon-button class="toggle" (click)="toggleStatus()" [attr.aria-label]="listing.status === 1 ? 'Pausar' : 'Reanudar'">
      <mat-icon>{{ listing.status === 1 ? 'pause' : 'play_arrow' }}</mat-icon>
    </button>
    <button mat-icon-button color="warn" class="delete" (click)="deleteClick.emit(listing.id)" aria-label="Eliminar">
      <mat-icon>delete</mat-icon>
    </button>
  </div>

  <mat-card class="left-card">
  <div class="image-wrapper">
      <img
        class="thumbnail"
        [src]="listing.mainImage"
        [alt]="listing.title || 'Publicaci\u00f3n sin t\u00edtulo'"
        loading="lazy"
        appDefaultImage decoding="async" />
    </div>

    <div class="text">
      <div class="content-grid">
        <div class="left-col">
          <div class="info-row">
            <h3 class="status">
              {{ listing.status === 1 ? "Activa" : "Pausada" }}
            </h3>
            <button
              mat-icon-button
              class="edit-btn"
              *ngIf="loadingSide !== 'left'"
              aria-label="Información"
              (click)="openEdit('left')"
            >
              <mat-icon>info</mat-icon>
            </button>
            <mat-spinner *ngIf="loadingSide === 'left'" diameter="20"></mat-spinner>
          </div>
          <p class="condition">
            {{ listing.condition == 2 ? "Nuevo" : "Usado" }}
          </p>
          <div class="price">$ {{ listing.price | number }}</div>
          <p class="desc">{{ listing.title }}</p>
        </div>

        <div class="right-col">
          <p class="type">{{ listing.type }}</p>
          <p class="created">
            Publicado el {{ listing.createdAt | date: 'dd/MM/yyyy' }}
          </p>
        </div>
      </div>
    </div>
  </mat-card>

  <!-- RIGHT CARD (descripción de 5 líneas) -->
  <mat-card class="right-card">
    <div class="info-row">
      <h3>Información sobre el producto</h3>
      <button
        mat-icon-button
        class="edit-btn"
        *ngIf="loadingSide !== 'right'"
        aria-label="Información"
        (click)="openEdit('right')"
      >
        <mat-icon>info</mat-icon>
      </button>
      <mat-spinner *ngIf="loadingSide === 'right'" diameter="20"></mat-spinner>
    </div>

    <div class="content-layout">
      <div class="description-section">
        <p class="label">Descripción</p>
        <p class="desc multiline">{{ listing.description }}</p>
      </div>

      <div class="payments-section">
        <p class="label">Medios de pago</p>
        <div class="chips">
          <span class="chip cash" *ngIf="listing.acceptsCash">EFECTIVO</span>
          <span class="chip card" *ngIf="listing.acceptsCard">TARJETA</span>
          <span class="chip transfer" *ngIf="listing.acceptsTransfer"
            >TRANSFERENCIA</span
          >
          <span class="chip barter" *ngIf="listing.acceptsBarter">TRUEQUE</span>
        </div>
      </div>
    </div>
  </mat-card>
</div>

<app-edit-publication
  *ngIf="editingSide"
  [listing]="listing"
  [fullInfo]="fullData"
  [side]="editingSide"
  [saving]="saving"
  (saved)="onSave($event)"
  (closed)="editingSide = null"
  (reload)="onListingModified()"
>
</app-edit-publication>
